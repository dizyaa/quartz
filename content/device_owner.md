---
tags:
  - work/wb
  - tech/android
title: Device Owner
---
**Режим Device Owner** — это особый режим работы Android-устройства, предназначенный для полного управления устройством, чаще всего в корпоративной среде. После активации устройство будет работать с ограничениями, установленными администратором.

**MDM** - Mobile Device Management, набор иструментов для управления устройством. Далее, так будет называться приложение с Device Owner. 

---

## 1. Что такое режим Device Owner

Режим Device Owner позволяет IT-администратору полностью контролировать устройство. Это используется для:
- Управления политиками безопасности.
- Ограничения доступа к приложениям.
- Удаленного контроля над устройством.

**Важно**: Перед включением режима Device Owner устройство сбрасывается до заводских настроек, и изменить владельца без сброса невозможно.

---

## 2. Подготовка устройства

Перед активацией необходимо выполнить следующие действия:
1. Устройство должно быть сброшено до заводских настроек.
2. Устройство не должно запомнить Google аккаунт после сброса.
3. Заряд аккумулятора должен быть выше 50%.

---

## 3. Подготовка к активации Device Owner

> [!WARNING] 
> Это глава нужна для формирования средств, для активации режима. Этим занимается IT-специалист или руководитель

### Способ 1: С помощью NFC 
**Требуется устройство с поддержкой NFC.**

***ПРИЛОЖЕНИЕ В ПРОЦЕССЕ РАЗРАБОТКИ***

   - Установите наше приложение-инициатор на устройство
   - Включите приложение, введите данные, если требуется, и включите распространение метки.
### Способ 2: С помощью QR-кода
**Для Android 9 и выше.**

1. Создайте ссылку для прямого доступа к APK-файлу и/или убедитесь что он доступен из той WiFi сети, в которой он будет подключен.  

```json
"android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_DOWNLOAD_LOCATION":
"ссылка на файл",
```
   
> [!tip] Запуск в локальной сети
> В локальной сети (для теста, например) это можно сделать с помощью Python
   `python3 -m http.server 8000` , в папке с файлом
   Тогда ваш файл будет доступен по `http://<локальный ip устройства>:8000/app-release.apk`


2. Для каждой версии сборки(например, новое обновление) нужна своя чек-сумма, соотвественно нужен разный QR-код. 
     Чтобы сформировать checksum, выполните эту команду
     `cat apk-release.apk | openssl dgst -binary -sha1 | openssl base64 | tr '+/' '-_' | tr -d '='`
     где `apk-release.apk`

```json
"android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM":
"E1i1v9dZbwKW2Gx2BHsGBlRqniZZ_9iEMQsXOSYS1_M", // чексумма, которая получилась
```

 3. Для формирования QR-кода нужны данные WiFi
```json
"android.app.extra.PROVISIONING_WIFI_SSID":"Тут имя сети",
"android.app.extra.PROVISIONING_WIFI_PASSWORD":"Тут пароль сети",
"android.app.extra.PROVISIONING_WIFI_SECURITY_TYPE":"WPA", // тут тип безопастности сети. Может быть WEP, WPA, WPA2, WPA3.
```


> [!abstract] Пример готового QR-кода
```json
{
"android.app.extra.PROVISIONING_DEVICE_ADMIN_COMPONENT_NAME":
"dev.dizyaa.testadmin/dev.dizyaa.testadmin.AdminReceiver", // имя пакета приложения/пакет, в котором помещен Receiver

"android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_NAME":
"dev.dizyaa.testadmin",

"android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_DOWNLOAD_LOCATION":
"http://192.168.1.128:8000/app-debug.apk",

"android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM":
"E1i1v9dZbwKW2Gx2BHsGBlRqniZZ_9iEMQsXOSYS1_M",

"android.app.extra.PROVISIONING_WIFI_SSID":"WH WIFI",
"android.app.extra.PROVISIONING_WIFI_PASSWORD":"12345678",
"android.app.extra.PROVISIONING_WIFI_SECURITY_TYPE":"WPA",

"android.app.extra.PROVISIONING_SKIP_ENCRYPTION": false,
"android.app.extra.PROVISIONING_LEAVE_ALL_SYSTEM_APPS_ENABLED":true
}
```


4. Преобразуем получений JSON в QR-код с помощью любых third-party иструментов. 
   Например, [tec-it.com](https://barcode.tec-it.com/en/QRCode)   
### Способ 3: С помощью установочного APK
**Для разработчиков и продвинутых пользователей.**

1. Скачайте APK-файл MDM. 
2. Установите *Android Debug Bridge (ADB).
3. Сбросьте устройство до заводских настроек.  
4. Подключитесь к устройству через ADB:  
   - Включите режим разработчика на устройстве (нажмите 7 раз на номер сборки в настройках).  
   - Подключите устройство к компьютеру по USB.  

5. Выполните команды:  
   ```bash
   adb install <путь_к_APK-файлу>
   adb shell dpm set-device-owner <имя_пакета/.администратор>
   ```
   Пример:  
   ```bash
   adb shell dpm set-device-owner com.example.mdm/com.example.mdm.DeviceAdminReceiver
   ```

6. Устройство перезагрузится(или нет), и режим Device Owner активируется.

---

## 4. Способы активации Device Owner

> [!NOTE]
> Глава для активации device owner, при этом все необходимые данные и ресурсы уже предоствленны
> 

### Способ 1: С помощью NFC 
**Требуется устройство с поддержкой NFC.**

1. На устройстве-инициаторе:  
   - Включите приложение, введите данные, если требуется, и включите распространение метки.
2. На целевом устройстве:
   - Подготовьте устройство для device owner
   - На экране первого запуска приложите NFC-метку или инициирующее устройство.  
   - Следуйте инструкциям на экране.

### Способ 2: С помощью QR-кода
**Для Android 9 и выше.**

1. Обратитесь к руководителю для получения QR-кода
3. На устройстве:  
   - Сбросьте устройство до заводских настроек.  
   - При настройке устройства (экран *"Welcome"*) нажмите 10 раз на экран в любом месте.  
   - В появившемся меню выберите **"Scan QR Code"**.  
   - Отсканируйте QR-код.  
   - Дождитесь завершения настройки

---

## 5. Часто задаваемые вопросы

### 1. Можно ли отключить режим Device Owner?
Нет, для удаления режима необходимо сбросить устройство до заводских настроек.

### 2. Подходит ли режим для личного телефона?
Режим предназначен для корпоративного использования. Включать его на личном устройстве не рекомендуется.

### 3. Что делать, если устройство не поддерживает NFC или QR-коды?
Используйте метод с APK и ADB.

### 4. Что делать, если происходит ошибка при попытки активации через QR-код и/или NFC?

Используйте альтернативные методы, на крайний случай метод с ручной установкой. Также обратитесь к руководителю с этой проблем.

---

Если у вас возникли дополнительные вопросы, обратитесь к руководителю или сотруднику, отвечающего за MDM.